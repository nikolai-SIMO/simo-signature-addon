<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMO Email Signatures</title>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: #3d5875;
            color: white;
            padding: 16px 24px;
            border-bottom: 3px solid #2a3f54;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .header p {
            font-size: 13px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .container {
            padding: 20px;
            padding-bottom: 80px;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
            margin-bottom: 0;
        }

        .tab-btn {
            flex: 1;
            padding: 14px 16px;
            border: none;
            background: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            background: #f6f8fa;
        }

        .tab-btn.active {
            color: #3d5875;
            border-bottom-color: #3d5875;
            background: #fafbfc;
        }

        /* Views */
        .view {
            display: none;
            background: white;
            border: 1px solid #e1e4e8;
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 20px;
        }

        .view.active {
            display: block;
        }

        /* Signature Section */
        .section {
            background: #fafbfc;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .section-header {
            background: #f6f8fa;
            border-bottom: 1px solid #e1e4e8;
            padding: 12px 16px;
            font-weight: 600;
            font-size: 14px;
        }

        #signatureList {
            display: flex;
            flex-direction: column;
        }

        .signature-btn {
            background: white;
            border: none;
            border-bottom: 1px solid #e1e4e8;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .signature-btn:last-child {
            border-bottom: none;
        }

        .signature-btn:hover {
            background: #f6f8fa;
        }

        .signature-btn:active {
            background: #e8f4f8;
        }

        .signature-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .signature-info {
            flex: 1;
        }

        .signature-info h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #333;
        }

        .signature-info p {
            font-size: 12px;
            color: #666;
        }

        .btn-primary {
            background: #3d5875;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }

        .btn-primary:hover {
            background: #2a3f54;
        }

        .btn-secondary {
            background: white;
            color: #3d5875;
            border: 2px solid #3d5875;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s;
            margin-top: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background: #f6f8fa;
        }

        /* Settings View */
        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #3d5875;
            padding-bottom: 8px;
            border-bottom: 1px solid #e1e4e8;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .form-group small {
            display: block;
            margin-top: 4px;
            font-size: 11px;
            color: #666;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            font-size: 13px;
            cursor: pointer;
        }

        .color-row {
            display: grid;
            grid-template-columns: 1fr 60px;
            gap: 8px;
            align-items: center;
        }

        input[type="color"] {
            height: 38px;
            cursor: pointer;
        }

        /* Custom Builder Styles */
        .builder-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .builder-section {
            background: #fafbfc;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 16px;
        }

        .builder-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #3d5875;
        }

        .templates-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .template-card {
            border: 2px solid #e1e4e8;
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            background: white;
        }

        .template-card:hover {
            border-color: #3d5875;
            background: #f6f8fa;
        }

        .template-card.selected {
            border-color: #3d5875;
            background: #e8f4f8;
        }

        .template-card h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .template-card p {
            font-size: 11px;
            color: #666;
        }

        .components-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .component-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .component-item:hover {
            background: #f6f8fa;
        }

        .component-item.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .component-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .component-label {
            flex: 1;
            font-size: 13px;
            margin-left: 10px;
        }

        .preview-box {
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 16px;
            background: white;
            max-height: 300px;
            overflow-y: auto;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .button-group button {
            flex: 1;
        }

        .back-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .back-button:hover {
            background: #5a6268;
        }

        .status-message {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 13px;
            text-align: center;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .save-indicator.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🖊️ SIMO Email Signatures</h1>
        <p>Professional signatures for your organization</p>
    </div>

    <div class="container">
        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('signatures')">📧 Signatures</button>
            <button class="tab-btn" onclick="switchTab('custom')">✨ Custom Builder</button>
            <button class="tab-btn" onclick="switchTab('settings')">⚙️ Settings</button>
        </div>

        <!-- Signatures View -->
        <div id="signaturesView" class="view active">
            <div class="section">
                <div class="section-header">Preview</div>
                <div style="padding: 16px;">
                    <div class="preview-box" id="mainPreview">
                        <!-- Preview will be rendered here -->
                    </div>
                    <small style="color: #666; display: block; margin-top: 8px;">Live preview of your signature with current settings</small>
                </div>
            </div>

            <div class="section">
                <div class="section-header">Pre-configured Signatures</div>
                <div id="signatureList">
                    <!-- Buttons will be added here by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Custom Builder View -->
        <div id="customView" class="view">
            <div id="builderStatus"></div>

            <div class="builder-container">
                <div class="builder-section">
                    <h3>1. Choose a Template</h3>
                    <div class="templates-grid" id="templatesList"></div>
                </div>

                <div class="builder-section">
                    <h3>2. Select Components</h3>
                    <div class="components-list" id="componentsList"></div>
                </div>

                <div class="builder-section">
                    <h3>3. Customize Text (Optional)</h3>
                    <div class="form-group">
                        <label>Custom Title/Tagline</label>
                        <input type="text" id="customTitle" placeholder="e.g., Innovation Starts Here">
                    </div>
                    <div class="form-group">
                        <label>Additional Text</label>
                        <textarea id="customText" placeholder="e.g., Schedule a meeting with me"></textarea>
                    </div>
                </div>

                <div class="builder-section">
                    <h3>4. Preview</h3>
                    <div class="preview-box" id="signaturePreview">
                        <p style="color: #666; text-align: center; padding: 20px;">Select a template to see preview</p>
                    </div>
                </div>

                <button class="btn-primary" onclick="applyCustomSignature()">Apply Signature</button>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settingsView" class="view">
            <div id="settingsStatus"></div>

            <!-- Contact Information -->
            <div class="settings-section">
                <h3>Contact Information</h3>
                
                <div class="form-group">
                    <label>Job Title</label>
                    <input type="text" id="settingJobTitle" placeholder="e.g., Senior Developer">
                    <small>Override your default job title</small>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="settingIncludePhone" onchange="saveSettings()">
                    <label for="settingIncludePhone">Include phone number in signature</label>
                </div>

                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="settingPhone" placeholder="+49 123 456789">
                    <small>Format: +49 123 456789</small>
                </div>

                <div class="form-group">
                    <label>Mobile Number</label>
                    <input type="tel" id="settingMobile" placeholder="+49 152 06348349">
                    <small>Format: +49 152 06348349</small>
                </div>
            </div>

            <!-- Typography -->
            <div class="settings-section">
                <h3>Typography</h3>
                
                <div class="form-group">
                    <label>Font Family</label>
                    <select id="settingFont" onchange="saveSettings()">
                        <option value="Arial">Arial</option>
                        <option value="Calibri">Calibri</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Verdana">Verdana</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Font Size (Name)</label>
                    <select id="settingNameSize" onchange="saveSettings()">
                        <option value="12pt">12pt - Small</option>
                        <option value="14pt" selected>14pt - Medium</option>
                        <option value="16pt">16pt - Large</option>
                        <option value="18pt">18pt - Extra Large</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Font Size (Body Text)</label>
                    <select id="settingBodySize" onchange="saveSettings()">
                        <option value="8pt">8pt - Tiny</option>
                        <option value="9pt">9pt - Small</option>
                        <option value="10pt" selected>10pt - Medium</option>
                        <option value="11pt">11pt - Large</option>
                    </select>
                </div>
            </div>

            <!-- Colors -->
            <div class="settings-section">
                <h3>Colors</h3>
                
                <div class="form-group">
                    <label>Name Color</label>
                    <div class="color-row">
                        <input type="text" id="settingNameColor" value="#152979" onchange="saveSettings()">
                        <input type="color" id="settingNameColorPicker" value="#152979" onchange="updateColorText('settingNameColor', this.value); saveSettings();">
                    </div>
                </div>

                <div class="form-group">
                    <label>Job Title Color</label>
                    <div class="color-row">
                        <input type="text" id="settingTitleColor" value="#9a9a9a" onchange="saveSettings()">
                        <input type="color" id="settingTitleColorPicker" value="#9a9a9a" onchange="updateColorText('settingTitleColor', this.value); saveSettings();">
                    </div>
                </div>

                <div class="form-group">
                    <label>Contact Info Color</label>
                    <div class="color-row">
                        <input type="text" id="settingContactColor" value="#9a9a9a" onchange="saveSettings()">
                        <input type="color" id="settingContactColorPicker" value="#9a9a9a" onchange="updateColorText('settingContactColor', this.value); saveSettings();">
                    </div>
                </div>
            </div>

            <!-- Social Media -->
            <div class="settings-section">
                <h3>Social Media</h3>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="settingShowLinkedIn" checked onchange="saveSettings()">
                    <label for="settingShowLinkedIn">Show LinkedIn icon</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="settingShowTeams" checked onchange="saveSettings()">
                    <label for="settingShowTeams">Show Microsoft Teams icon</label>
                </div>
            </div>

            <!-- Preview -->
            <div class="settings-section">
                <h3>Preview</h3>
                <div class="preview-box" id="settingsPreview">
                    <!-- Preview will be rendered here -->
                </div>
                <small style="color: #666; display: block; margin-top: 8px;">Settings preview - changes shown above in real-time</small>
            </div>

            <button class="btn-primary" onclick="resetSettings()">Reset to Defaults</button>
        </div>
    </div>

    <div class="save-indicator" id="saveIndicator">✓ Settings saved</div>

    <script>
        let userProfile = {};
        let selectedTemplate = null;
        let selectedComponents = {
            logo: true,
            name: true,
            jobTitle: true,
            email: true,
            mobilePhone: false,
            businessPhone: false,
            linkedin: false,
            teams: false
        };

        // Default settings
        let userSettings = {
            jobTitle: '',
            includePhone: false,
            phone: '',
            mobile: '',
            font: 'Arial',
            nameSize: '14pt',
            bodySize: '10pt',
            nameColor: '#152979',
            titleColor: '#9a9a9a',
            contactColor: '#9a9a9a',
            showLinkedIn: true,
            showTeams: true
        };

        const templates = [
            { id: 'minimal', name: 'Minimal', description: 'Clean & simple', style: 'minimal' },
            { id: 'professional', name: 'Professional', description: 'Classic corporate', style: 'professional' },
            { id: 'modern', name: 'Modern', description: 'Bold & contemporary', style: 'modern' },
            { id: 'social', name: 'Social Focus', description: 'Social media emphasis', style: 'social' }
        ];

        const components = [
            { id: 'logo', label: 'Company Logo', required: false },
            { id: 'name', label: 'Full Name', required: true },
            { id: 'jobTitle', label: 'Job Title', required: true },
            { id: 'email', label: 'Email Address', required: true },
            { id: 'mobilePhone', label: 'Mobile Phone', required: false },
            { id: 'businessPhone', label: 'Business Phone', required: false },
            { id: 'linkedin', label: 'LinkedIn Icon', required: false },
            { id: 'teams', label: 'Microsoft Teams Icon', required: false }
        ];

        // Initialize when Office is ready
        Office.onReady(function() {
            loadSettings();
            getUserProfile();
            loadSignatures();
            renderTemplates();
            renderComponents();
            populateSettingsForm();
        });

        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update views
            document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
            if (tab === 'signatures') {
                document.getElementById('signaturesView').classList.add('active');
            } else if (tab === 'custom') {
                document.getElementById('customView').classList.add('active');
            } else if (tab === 'settings') {
                document.getElementById('settingsView').classList.add('active');
            }
        }

        function getUserProfile() {
            userProfile = {
                displayName: Office.context.mailbox.userProfile.displayName || '[Your Name]',
                email: Office.context.mailbox.userProfile.emailAddress || '[email@example.com]',
                givenName: '[First Name]',
                surname: '[Last Name]'
            };
        }

        function loadSettings() {
            const saved = localStorage.getItem('simoSignatureSettings');
            if (saved) {
                userSettings = JSON.parse(saved);
            }
        }

        function saveSettings() {
            // Get values from form
            userSettings.jobTitle = document.getElementById('settingJobTitle').value;
            userSettings.includePhone = document.getElementById('settingIncludePhone').checked;
            userSettings.phone = document.getElementById('settingPhone').value;
            userSettings.mobile = document.getElementById('settingMobile').value;
            userSettings.font = document.getElementById('settingFont').value;
            userSettings.nameSize = document.getElementById('settingNameSize').value;
            userSettings.bodySize = document.getElementById('settingBodySize').value;
            userSettings.nameColor = document.getElementById('settingNameColor').value;
            userSettings.titleColor = document.getElementById('settingTitleColor').value;
            userSettings.contactColor = document.getElementById('settingContactColor').value;
            userSettings.showLinkedIn = document.getElementById('settingShowLinkedIn').checked;
            userSettings.showTeams = document.getElementById('settingShowTeams').checked;

            // Save to localStorage
            localStorage.setItem('simoSignatureSettings', JSON.stringify(userSettings));

            // Update both previews
            updateSettingsPreview();
            updateMainPreview();

            // Show save indicator
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 2000);
        }

        function populateSettingsForm() {
            document.getElementById('settingJobTitle').value = userSettings.jobTitle;
            document.getElementById('settingIncludePhone').checked = userSettings.includePhone;
            document.getElementById('settingPhone').value = userSettings.phone;
            document.getElementById('settingMobile').value = userSettings.mobile;
            document.getElementById('settingFont').value = userSettings.font;
            document.getElementById('settingNameSize').value = userSettings.nameSize;
            document.getElementById('settingBodySize').value = userSettings.bodySize;
            document.getElementById('settingNameColor').value = userSettings.nameColor;
            document.getElementById('settingNameColorPicker').value = userSettings.nameColor;
            document.getElementById('settingTitleColor').value = userSettings.titleColor;
            document.getElementById('settingTitleColorPicker').value = userSettings.titleColor;
            document.getElementById('settingContactColor').value = userSettings.contactColor;
            document.getElementById('settingContactColorPicker').value = userSettings.contactColor;
            document.getElementById('settingShowLinkedIn').checked = userSettings.showLinkedIn;
            document.getElementById('settingShowTeams').checked = userSettings.showTeams;
            
            // Initial preview updates
            updateSettingsPreview();
            updateMainPreview();
        }

        function updateColorText(inputId, color) {
            document.getElementById(inputId).value = color;
        }

        function resetSettings() {
            if (confirm('Reset all settings to default values?')) {
                localStorage.removeItem('simoSignatureSettings');
                userSettings = {
                    jobTitle: '',
                    includePhone: false,
                    phone: '',
                    mobile: '',
                    font: 'Arial',
                    nameSize: '14pt',
                    bodySize: '10pt',
                    nameColor: '#152979',
                    titleColor: '#9a9a9a',
                    contactColor: '#9a9a9a',
                    showLinkedIn: true,
                    showTeams: true
                };
                populateSettingsForm();
                updateSettingsPreview();
                updateMainPreview();
                showSettingsStatus('Settings reset to defaults', 'success');
            }
        }

        function updateMainPreview() {
            const preview = document.getElementById('mainPreview');
            if (!preview) return;
            
            preview.innerHTML = getDefaultSignatureHTML();
        }

        function updateSettingsPreview() {
            const preview = document.getElementById('settingsPreview');
            if (!preview) return;
            
            preview.innerHTML = getDefaultSignatureHTML();
        }

        function loadSignatures() {
            const signatureList = document.getElementById('signatureList');
            
            const signatures = [
                {
                    name: 'Default Signature',
                    description: 'Standard SIMO employee signature',
                    icon: '📧'
                },
                {
                    name: 'All Mail Signature',
                    description: 'Signature with legal disclaimer',
                    icon: '📄'
                }
            ];

            signatureList.innerHTML = signatures.map((sig, index) => `
                <button class="signature-btn" onclick="applySignature(${index})">
                    <div class="signature-icon">${sig.icon}</div>
                    <div class="signature-info">
                        <h3>${sig.name}</h3>
                        <p>${sig.description}</p>
                    </div>
                </button>
            `).join('');
        }

        function getDefaultSignatureHTML() {
            const jobTitle = userSettings.jobTitle || '[Job Title]';
            const phone = userSettings.phone || '[Phone]';
            const mobile = userSettings.mobile || '[Mobile]';
            
            let phoneHTML = '';
            if (userSettings.includePhone) {
                if (userSettings.phone) {
                    phoneHTML += `phone. <a href="tel:${phone}" style="color: ${userSettings.contactColor}; text-decoration: none;">${phone}</a><br>`;
                }
                if (userSettings.mobile) {
                    phoneHTML += `mobile. <a href="tel:${mobile}" style="color: ${userSettings.contactColor}; text-decoration: none;">${mobile}</a><br>`;
                }
            }

            let socialHTML = '';
            if (userSettings.showLinkedIn || userSettings.showTeams) {
                socialHTML = '<tr><td valign="top" style="padding-bottom: 10px; padding-top: 10px;">';
                if (userSettings.showLinkedIn) {
                    socialHTML += '<a href="https://www.linkedin.com/company/simo-online" style="text-decoration: none;"><img src="https://nikolai-SIMO.github.io/simo-signature-addon/linkedin-icon.png" border="0" width="32" height="32" alt="LinkedIn" style="display: inline-block; margin-right: 8px;"></a>';
                }
                if (userSettings.showTeams) {
                    socialHTML += `<a href="https://teams.microsoft.com/l/chat/0/0?users=${userProfile.email}" style="text-decoration: none;"><img src="https://nikolai-SIMO.github.io/simo-signature-addon/teams-icon.png" border="0" width="32" height="32" alt="Microsoft Teams" style="display: inline-block;"></a>`;
                }
                socialHTML += '</td></tr>';
            }

            return `<table style="WIDTH: 508px; FONT-SIZE: ${userSettings.bodySize}; FONT-FAMILY: ${userSettings.font}; MARGIN-TOP: 0px; MARGIN-BOTTOM: 5pt" cellspacing="0" cellpadding="0" border="0"><tbody><tr><td style="FONT-SIZE: ${userSettings.bodySize}; FONT-FAMILY: ${userSettings.font}; PADDING-BOTTOM: 10px" valign="top"><span style="FONT-SIZE: ${userSettings.nameSize}"><strong><font color="${userSettings.nameColor}">${userProfile.displayName}</font></strong></span><br><span style="font-size: ${userSettings.bodySize}; color: ${userSettings.titleColor};">${jobTitle}</span><br><br><span style="font-size: ${userSettings.bodySize}; color: ${userSettings.contactColor};">${phoneHTML}email. <a href="mailto:${userProfile.email}" style="color: ${userSettings.contactColor}; text-decoration: none;">${userProfile.email}</a></span></td></tr></tbody></table><table cellspacing="0" cellpadding="0" border="0" style="font-size: ${userSettings.bodySize}; WIDTH: 508px"><tbody><tr><td valign="top" style="padding-bottom: 10px; padding-top: 10px;"><a href="https://www.simo-online.com/"><img src="https://nikolai-SIMO.github.io/simo-signature-addon/simo-logo.png" border="0" width="150" height="49" alt="SIMO logo" style="display: block;"></a></td></tr>${socialHTML}</tbody></table>`;
        }

        function getAllMailSignatureHTML() {
            const defaultSig = getDefaultSignatureHTML();
            return defaultSig + `<hr style="color: rgb(197, 200, 203); margin-top: 20px;"><p style="color: rgb(197, 200, 203); font-size: 8pt; font-family: ${userSettings.font}; margin-top: 5pt;">Diese E-Mail enthaelt vertrauliche und/oder rechtlich geschuetzte Informationen. Wenn Sie nicht der beabsichtigte Empfaenger sind, informieren Sie bitte sofort den Absender und loeschen Sie diese E-Mail. Das unbefugte Kopieren dieser E-Mail oder die unbefugte Weitergabe der enthaltenen Informationen ist nicht gestattet. /|/ The information contained in this message is confidential or protected by law. If you are not the intended recipient, please contact the sender and delete this message. Any unauthorised copying of this message or unauthorised distribution of the information contained herein is prohibited.</p><hr style="color: rgb(197, 200, 203);"><p style="color: rgb(197, 200, 203); font-size: 8pt; font-family: ${userSettings.font}; margin-top: 5pt;">Legally required information for business correspondence/ Gesetzliche Pflichtangaben fuer Geschaeftskorrespondenz<br>Unternehmen/Company: SIMO GmbH mit Sitz/with registered seat in Aschaffenburg, Amtsgericht/local court Aschaffenburg HRB 15769, Umsatzsteuer-Identifikationsnummer / VAT-ID DE335322803, Geschaeftsanschrift: Würzburger Straße 152, 63743 Aschaffenburg<br>Geschaeftsfuehrung/Management Board: Thomas Wassum und Andreas O. Schwan</p>`;
        }

        function applySignature(index) {
            const signatures = [
                { html: getDefaultSignatureHTML() },
                { html: getAllMailSignatureHTML() }
            ];

            const signatureHTML = signatures[index].html;

            Office.context.mailbox.item.body.setSignatureAsync(
                signatureHTML,
                { coercionType: Office.CoercionType.Html },
                function(asyncResult) {
                    if (asyncResult.status === Office.AsyncResultStatus.Failed) {
                        alert('Error applying signature: ' + asyncResult.error.message);
                    } else {
                        alert('Signature applied successfully!');
                    }
                }
            );
        }

        function renderTemplates() {
            const list = document.getElementById('templatesList');
            list.innerHTML = templates.map(template => `
                <div class="template-card ${selectedTemplate?.id === template.id ? 'selected' : ''}" 
                     onclick="selectTemplate('${template.id}')">
                    <h4>${template.name}</h4>
                    <p>${template.description}</p>
                </div>
            `).join('');
        }

        function renderComponents() {
            const list = document.getElementById('componentsList');
            list.innerHTML = components.map(comp => `
                <div class="component-item ${comp.required ? 'disabled' : ''}">
                    <input type="checkbox" 
                           id="comp_${comp.id}" 
                           ${selectedComponents[comp.id] ? 'checked' : ''}
                           ${comp.required ? 'disabled checked' : ''}
                           onchange="toggleComponent('${comp.id}')">
                    <label class="component-label" for="comp_${comp.id}">
                        ${comp.label}${comp.required ? ' (Required)' : ''}
                    </label>
                </div>
            `).join('');
        }

        function selectTemplate(templateId) {
            selectedTemplate = templates.find(t => t.id === templateId);
            renderTemplates();
            updatePreview();
        }

        function toggleComponent(componentId) {
            selectedComponents[componentId] = !selectedComponents[componentId];
            updatePreview();
        }

        function updatePreview() {
            if (!selectedTemplate) return;

            const preview = document.getElementById('signaturePreview');
            const customTitle = document.getElementById('customTitle')?.value || '';
            const customText = document.getElementById('customText')?.value || '';

            const signatureHTML = generateSignatureHTML(selectedTemplate, selectedComponents, customTitle, customText);
            preview.innerHTML = signatureHTML;
        }

        function generateSignatureHTML(template, components, customTitle, customText) {
            let html = `<table cellpadding="0" cellspacing="0" style="font-family: ${userSettings.font}; font-size: ${userSettings.bodySize}; line-height: 1.5;">`;
            
            if (components.logo) {
                html += '<tr><td style="padding-bottom: 10px;"><img src="https://nikolai-SIMO.github.io/simo-signature-addon/simo-logo.png" alt="SIMO Logo" style="height: 40px; display: block;"></td></tr>';
            }

            if (customTitle) {
                html += `<tr><td style="font-weight: bold; color: ${userSettings.nameColor}; padding-bottom: 8px; font-size: ${userSettings.nameSize};">${customTitle}</td></tr>`;
            }

            if (components.name) {
                html += `<tr><td style="font-weight: bold; font-size: ${userSettings.nameSize}; color: ${userSettings.nameColor}; padding-bottom: 4px;">${userProfile.displayName}</td></tr>`;
            }

            if (components.jobTitle) {
                html += `<tr><td style="color: ${userSettings.titleColor}; padding-bottom: 8px;">${userSettings.jobTitle || '[Job Title]'}</td></tr>`;
            }

            if (components.email) {
                html += `<tr><td style="padding-bottom: 4px;"><a href="mailto:${userProfile.email}" style="color: ${userSettings.contactColor}; text-decoration: none;">${userProfile.email}</a></td></tr>`;
            }

            if (components.mobilePhone && userSettings.mobile) {
                html += `<tr><td style="padding-bottom: 4px; color: ${userSettings.contactColor};">📱 ${userSettings.mobile}</td></tr>`;
            }

            if (components.businessPhone && userSettings.phone) {
                html += `<tr><td style="padding-bottom: 4px; color: ${userSettings.contactColor};">☎️ ${userSettings.phone}</td></tr>`;
            }

            if (customText) {
                html += `<tr><td style="padding-top: 8px; padding-bottom: 4px; font-style: italic; color: ${userSettings.contactColor}; font-size: ${userSettings.bodySize};">${customText}</td></tr>`;
            }

            if ((components.linkedin && userSettings.showLinkedIn) || (components.teams && userSettings.showTeams)) {
                html += '<tr><td style="padding-top: 10px;">';
                if (components.linkedin && userSettings.showLinkedIn) {
                    html += '<a href="https://linkedin.com/company/simo-gmbh" style="margin-right: 10px; text-decoration: none; color: #0077b5;">🔗 LinkedIn</a>';
                }
                if (components.teams && userSettings.showTeams) {
                    html += '<span style="color: #6264A7;">💬 Teams</span>';
                }
                html += '</td></tr>';
            }

            html += '</table>';
            return html;
        }

        function applyCustomSignature() {
            if (!selectedTemplate) {
                showStatus('Please select a template first', 'error');
                return;
            }

            const customTitle = document.getElementById('customTitle').value;
            const customText = document.getElementById('customText').value;
            const signatureHTML = generateSignatureHTML(selectedTemplate, selectedComponents, customTitle, customText);

            Office.context.mailbox.item.body.setSignatureAsync(
                signatureHTML,
                { coercionType: Office.CoercionType.Html },
                function(result) {
                    if (result.status === Office.AsyncResultStatus.Succeeded) {
                        showStatus('✓ Custom signature applied successfully!', 'success');
                    } else {
                        showStatus('❌ Failed to apply signature', 'error');
                    }
                }
            );
        }

        function showStatus(message, type) {
            const status = document.getElementById('builderStatus');
            status.innerHTML = `<div class="status-message ${type}">${message}</div>`;
            setTimeout(() => status.innerHTML = '', 5000);
        }

        function showSettingsStatus(message, type) {
            const status = document.getElementById('settingsStatus');
            status.innerHTML = `<div class="status-message ${type}">${message}</div>`;
            setTimeout(() => status.innerHTML = '', 3000);
        }

        // Event listeners for custom field updates
        setTimeout(() => {
            const customTitle = document.getElementById('customTitle');
            const customText = document.getElementById('customText');
            
            if (customTitle) customTitle.addEventListener('input', updatePreview);
            if (customText) customText.addEventListener('input', updatePreview);

            // Auto-save settings on input
            const settingsInputs = document.querySelectorAll('#settingsView input, #settingsView select, #settingsView textarea');
            settingsInputs.forEach(input => {
                input.addEventListener('change', saveSettings);
                // Also update both previews on text input
                if (input.type === 'text' || input.type === 'tel' || input.tagName === 'TEXTAREA') {
                    input.addEventListener('input', () => {
                        updateSettingsPreview();
                        updateMainPreview();
                    });
                }
            });
        }, 100);
    </script>
</body>
</html>
