<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMO Email Signatures</title>
    <script src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            background: linear-gradient(135deg, #1a365d 0%, #2d5a87 100%);
            color: white;
            padding: 15px;
            text-align: center;
        }
        .header h1 { font-size: 18px; font-weight: 600; }
        .status-bar {
            padding: 10px 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-bar.loading { background: #fff3cd; color: #856404; }
        .status-bar.ready { background: #d4edda; color: #155724; }
        .status-bar.error { background: #f8d7da; color: #721c24; }
        .spinner {
            width: 14px; height: 14px;
            border: 2px solid #856404;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .content { flex: 1; padding: 15px; overflow-y: auto; padding-bottom: 70px; }
        
        .signature-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .signature-card:hover {
            border-color: #2d5a87;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .signature-card h3 { font-size: 14px; color: #1a365d; margin-bottom: 5px; }
        .signature-card p { font-size: 11px; color: #666; }
        
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            border-top: 1px solid #ddd;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        .nav-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 11px;
            color: #666;
            transition: all 0.2s;
        }
        .nav-btn:hover { background: #f0f0f0; }
        .nav-btn.active { color: #1a365d; font-weight: 600; border-top: 2px solid #1a365d; }
        
        .view { display: none; }
        .view.active { display: block; }
        
        .settings-group { 
            background: white; 
            border-radius: 8px; 
            padding: 15px; 
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .settings-group h3 { 
            font-size: 13px; 
            color: #1a365d; 
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .setting-item:last-child { border-bottom: none; }
        .setting-item label { font-size: 12px; color: #333; }
        
        .toggle {
            position: relative;
            width: 44px;
            height: 24px;
        }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 24px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        .toggle input:checked + .toggle-slider { background-color: #1a365d; }
        .toggle input:checked + .toggle-slider:before { transform: translateX(20px); }
        
        .setting-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 5px;
        }
        .setting-input:focus { outline: none; border-color: #1a365d; }
        .setting-item.column { flex-direction: column; align-items: flex-start; }
        .setting-item.column label { margin-bottom: 5px; }
        
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            font-size: 10px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
        .debug-info h4 { font-size: 11px; margin-bottom: 5px; color: #1a365d; }
        .debug-info p { margin: 2px 0; }
        
        .user-info-card {
            background: linear-gradient(135deg, #1a365d 0%, #2d5a87 100%);
            color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .user-info-card h3 { font-size: 14px; margin-bottom: 4px; }
        .user-info-card p { font-size: 11px; opacity: 0.9; margin: 2px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üñäÔ∏è SIMO Email Signatures</h1>
    </div>
    
    <div id="status" class="status-bar loading">
        <div class="spinner"></div>
        <span>Initializing...</span>
    </div>
    
    <div class="content">
        <div id="signaturesView" class="view active">
            <div id="userInfoCard" class="user-info-card">
                <h3 id="userName">Loading...</h3>
                <p id="userTitle"></p>
                <p id="userEmail"></p>
            </div>
            
            <div class="signature-card" onclick="applySignature('default')">
                <h3>üìù Default Signature</h3>
                <p>Standard SIMO email signature with your contact details</p>
            </div>
            <div class="signature-card" onclick="applySignature('full')">
                <h3>üìã Full Signature + Legal</h3>
                <p>Complete signature with legal disclaimer (for external emails)</p>
            </div>
            <div class="signature-card" onclick="applySignature('legalonly')">
                <h3>‚öñÔ∏è Legal Footer Only</h3>
                <p>Add legal disclaimer to an existing email</p>
            </div>
        </div>
        
        <div id="settingsView" class="view">
            <div class="settings-group">
                <h3>üë§ Profile</h3>
                <div class="setting-item">
                    <label>Show Profile Photo</label>
                    <label class="toggle">
                        <input type="checkbox" id="showProfilePhoto" checked onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="settings-group">
                <h3>üìû Contact Information</h3>
                <div class="setting-item">
                    <label>Show Phone Number</label>
                    <label class="toggle">
                        <input type="checkbox" id="showPhone" checked onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>Show Mobile Number</label>
                    <label class="toggle">
                        <input type="checkbox" id="showMobile" checked onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-item column">
                    <label>Custom Phone (optional)</label>
                    <input type="text" class="setting-input" id="customPhone" placeholder="e.g. +49 6021 12345" onchange="saveSettings()">
                </div>
                <div class="setting-item column">
                    <label>Custom Mobile (optional)</label>
                    <input type="text" class="setting-input" id="customMobile" placeholder="e.g. +49 170 1234567" onchange="saveSettings()">
                </div>
            </div>
            
            <div class="settings-group">
                <h3>üîó Social Media</h3>
                <div class="setting-item">
                    <label>Show Social Media Icons</label>
                    <label class="toggle">
                        <input type="checkbox" id="showSocialMedia" checked onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>Show Teams Link</label>
                    <label class="toggle">
                        <input type="checkbox" id="showTeams" checked onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="settings-group">
                <h3>üé® Appearance</h3>
                <div class="setting-item column">
                    <label>Font Family</label>
                    <select class="setting-input" id="fontFamily" onchange="saveSettings()">
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="'Segoe UI', sans-serif">Segoe UI</option>
                        <option value="Calibri, sans-serif">Calibri</option>
                    </select>
                </div>
                <div class="setting-item column">
                    <label>Name Color</label>
                    <input type="color" class="setting-input" id="nameColor" value="#152979" onchange="saveSettings()" style="height: 35px;">
                </div>
            </div>
            
            <div class="settings-group">
                <h3>üîß Debug</h3>
                <div id="debugInfo" class="debug-info"><p>Loading...</p></div>
            </div>
        </div>
    </div>
    
    <nav class="nav-bar">
        <button class="nav-btn active" id="navSignatures" onclick="switchView('signatures')">‚úâÔ∏è Signatures</button>
        <button class="nav-btn" id="navSettings" onclick="switchView('settings')">‚öôÔ∏è Settings</button>
    </nav>

    <script>
        // Base64 encoded social media icons (24x24 PNG)
        var ICONS = {
            linkedin: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAABKklEQVR4nO2UPUoDURSFv4wmjRtQG0Gwc0lZWAi6AbUTXICFhYVgZWHhJkTXoJVgIa5ACKI7cAFiSCGk+AlMMpl5Y0bm51UeuNzhnXvuuY8L/+oWA8AngB4wu+FDYBd4+g5J1rAMLAN3pf15YFRVgLUSwHb+AJMVA0yXAJ5yvAFcAGsSAJOlAKPkpn0IzAMPuQDtRIIR4BE4BI6Bq1yApuwEGAXWgC3gLhugrTohpoEDYBK4TAJYBo6AK2A2C3Ak+xSYApYyAXIqDgDDCiA30icLMAccKYBciwNgS7ZRBTAV7wHWKwDSCVoGuMkFyKh4vOKelAaYjPfqAE7FAaBfdyAzkE7wXE1AR1wAy8B+LkBHXABv1QTsxAWwWQvgVLdKUzUBzquxJL0BdAWvMQ7YxYsAAAAASUVORK5CYII=',
            youtube: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVR4nO2TPU4DMRCFP0gKJHagpaGgoqLkDHAGrsARuAD04QpcABo6CgoKJBokxH9BspIV7Tqbze4mUvKkkTzjeZ73bMP/+jPKAXvAELjrmfvAIXD+lSV9BViqCNC1XgFbNQGm0wD3bdYAmE8DXBf4AHgsgIcmvKoOsJkGuGnDA+BB9ifA00RJSvcl8NAmwDhwCqy0DLAEHALLLQOUpgGwJvsk7RzwnwfMJwEWZD8EngdYA0ZmgGVgBNgfA/wFLjoF3AJWxwG/AwcdAbwBrhsB7gKbNkAXgEvZdxoAfAQ2ugBcAbfW+CnwDDzbJJotwi3gwvrcA542AUYJbJMuwEMSYKsmwGUSYLUmwHwSYKEmwEISYKYmwFQS4E9r/AHZbfCQUiZLfAAAAABJRU5ErkJggg==',
            instagram: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7klEQVR4nO2Uu0oDQRiFv3gBa6294AUsLCy8gI2NjY0P4Av4AD6CPoKFhYWFjYWFhYVYiFdUvKBRMSqaRL3gLZpEk43ZODvJbjYbL6AD/zDMnDn/+WdnYOAfP1oeIAmcA3VAOZADrAJ3wBuQFB3HADlyCqQDmcBMUsBhKVAdQ8BsUkCTnOLowXEQHwdcyjQcCTKANe07gcM0AYuB0njCVQMi9WgFNgXx2DExH2BvOgAaIwCWAvVRgPIIwFCEJgkDqAJao6z7E6S1bwPa0gU0RdEcyC48SXwdS5pDATqiFm8EysICJqKAbKArrfNEtKlj4JuHFd+0XQcehdEeGDgObPdkNhCgMwpgJFCX7qYwJ+BLsAvcAXdALdACNAAtwDpwLXgR3B2FGD2aPACvwIngi4Fj4AQ4FRzKfB44ANqjmqYM+As8CR4K7sIGnAJ7wJ7gu+BW9h1AT9TqrcKnwIHgHuwl8Ce4A+iKWr0n5hQ4ABxZgG3ZdwG9UYD9JDCwADuyHwD6ogBHFmBX9oPAYBTgOAkMLMCe7IeA4SjASRIYWIA92Y8Ao1GAsyQwsAAHsh8HxqMAF0lg8A24lP0kMBUFuE4CA/lPuJL9DDAbBbhJAgMLcCv7eWAhCnCXBAb2n3An+yVgOQrwkAQG8h/rE5PGBDh/NjneAAAAAElFTkSuQmCC',
            x: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7UlEQVR4nO2UMQ6CQBBF34mewsLCROMBPIEn8Ah6BT2C3sAb2FhYWNhYWFhYGI0lxkQNKoLAzrILGN1kksnu/P/nTwYW/vU3qgJaQDfwPAa0geMgpQm0A/cjICPY7+n6CswCr1WAThAYAsfAcw3gIGjJOKA7AYyAq6DA5SDgD1AxfCewlxDgexAYA3eTAM2AyUSAtYSAdUKAb8HgH7CZEOArMPIHzCcE+AKMkwD2EgJ8Bcb/gJ2EAF+A8SRAPyHAd2CUBHCQEOAbMEwC2EsI8A0YJgEcJAT4BgySAPYSAnwDBkkAewkBvgCDJIA/rRcsqxL2bqgZDgAAAABJRU5ErkJggg==',
            tiktok: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVR4nO2Uu0oDURCGP0QbsbARC7HwAt7ARrCxsfEFfAEfwUfQR7CwsLCwsbCwsLAQC/GCF9CoaIwaE5O4MXvJbHY3JhcD+sPA7Jw5/z9nZuFPv1IqYBfYBCaBYaAPaANugXvgGWgET0eBXCBXTgU4ygDWswF0RxAwlRWgR07xdOE4jI8DrmQaDgVpwIryneDhNAC1UYByfxqBDUE8dhzMhthLB0BDBMBcoCYKUBEBGIzQJGYAlUBrlHV/gtT2TUBruoD6KJoD2YXHia9jSXMoQHvU4vVAaViAxBhAHtCW1nki2tQx8NXDim/abgD3wugIDBwFtvsy6w/QFgUwHKhLd1OYE/AtWAVugCugGmgAmoE1YEPwJLg5CjF6MHkE3oETwScDx8EJcCp4kPkccAi0RzVNGfAXeBY8FNyGDTgB9oB9wXfBrew7gfao1duFT4F9wQPYi+NvcB/YA/YE3wW3su8EuqJWbxU+Bw4E92AvgT/BHUBnVOu9AJNsW+mDhwizAAAAAElFTkSuQmCC',
            teams: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAABb0lEQVR4nO2UvUoDQRSFv0QbsbARCzH+gE9gY2NjY2PjC/gCPoKPoI9gYWFhYWNhYWFhIRbiD16IGtGosVBj4u5kZ5PdbNRF8MDAXO6ce+bO3cKf/qZUwB6wCUwCw0Af0AbcAvfAM9AIngeCnCBXTgU4zABW0wF0RxAwlRWgR07xdOE4jI8DrmUaDgVpwIryndDhNAC1UYByfxqBdUE8duzPBthLB0BDBMBcoCoKUBEBGIzQJGYAlUBrlHV/gtT2TUBruoD6KJoD2YXHia9jSXMoQHvU4vVAaViAxBhAHtCW1nki2tQx8NXDim/abgD3wugIDBwFtvsy6wvQFgUwHKhLd1OYE/AtuAaugWugGmgAmoE14ErwJLg5CjF6MHkC3oETwScDx8AJcCp4kPk8cAi0RzVNGfAXeBY8EtyGDTgG9oF9wXfBrez7gI6o1duFT4B9wQPYS+BPcD+wB+wLvgteyb4P6IxavVX4HDgQ3IO9OP4ED4A2k3jZYH4AAAAASUVORK5CYII='
        };

        // Company Info
        var COMPANY = {
            name: 'SIMO GmbH',
            address: 'W√ºrzburger Stra√üe 152',
            city: '63743 Aschaffenburg',
            phone: '+49 (0)6021 3274550',
            website: 'https://www.simo-online.com/',
            email: 'info@simo-online.com',
            logo: 'https://nikolai-simo.github.io/simo-signature-addon/simo-logo.png',
            social: {
                linkedin: 'https://www.linkedin.com/company/simo-online',
                youtube: 'https://www.youtube.com/@SIMOMakeDataEasy',
                instagram: 'https://www.instagram.com/simo_makedataeasy/',
                x: 'https://x.com/SIMO_GmbH',
                tiktok: 'https://www.tiktok.com/@simo.makedataeasy'
            },
            legal: {
                court: 'Amtsgericht Aschaffenburg HRB 15769',
                vatId: 'DE335322803',
                mgmt: 'Thomas Wassum und Andreas O. Schwan'
            }
        };

        // User profile
        var userProfile = {
            displayName: 'SIMO Employee',
            email: '',
            jobTitle: '',
            phone: '',
            mobile: '',
            photoBase64: null
        };

        // Settings
        var userSettings = {
            showPhone: true,
            showMobile: true,
            showSocialMedia: true,
            showTeams: true,
            showProfilePhoto: true,
            customPhone: '',
            customMobile: '',
            font: 'Arial, sans-serif',
            nameColor: '#152979',
            contactColor: '#9a9a9a'
        };

        // API info
        var apiInfo = {
            version: 'unknown',
            hasSetSelectedData: false,
            hasSetSignature: false,
            hasBodySet: false,
            hasBodyGet: false
        };

        var debugLog = [];

        function log(msg) {
            debugLog.push('[' + new Date().toLocaleTimeString() + '] ' + msg);
            console.log('[SIMO] ' + msg);
        }

        function updateDebug() {
            var el = document.getElementById('debugInfo');
            if (el) {
                el.innerHTML = '<h4>API:</h4>' +
                    '<p>Version: ' + apiInfo.version + '</p>' +
                    '<p>setSelectedData: ' + (apiInfo.hasSetSelectedData ? '‚úÖ' : '‚ùå') + '</p>' +
                    '<p>setSignature: ' + (apiInfo.hasSetSignature ? '‚úÖ' : '‚ùå') + '</p>' +
                    '<h4>Profile:</h4>' +
                    '<p>Photo: ' + (userProfile.photoBase64 ? '‚úÖ Loaded' : '‚ùå Not loaded') + '</p>' +
                    '<h4>Log:</h4>' +
                    debugLog.slice(-5).map(function(l) { return '<p>' + l + '</p>'; }).join('');
            }
        }

        // Office init
        Office.onReady(function(info) {
            log('Office ready: ' + info.host);
            
            if (info.host === Office.HostType.Outlook) {
                detectAPI();
                loadProfile();
                loadSettings();
                fetchProfilePhoto();
                showStatus('Ready! Select a signature.', 'ready');
            } else {
                showStatus('Error: Not in Outlook', 'error');
            }
        });

        function fetchProfilePhoto() {
            try {
                if (!Office.context.mailbox || !Office.context.mailbox.restUrl) {
                    log('REST API not available for photo');
                    return;
                }

                Office.context.mailbox.getCallbackTokenAsync({ isRest: true }, function(result) {
                    if (result.status !== Office.AsyncResultStatus.Succeeded) {
                        log('Could not get REST token');
                        return;
                    }

                    var token = result.value;
                    var restUrl = Office.context.mailbox.restUrl;

                    // Fetch profile photo
                    var xhr = new XMLHttpRequest();
                    xhr.open('GET', restUrl + '/v2.0/me/photo/$value', true);
                    xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                    xhr.responseType = 'blob';
                    
                    xhr.onload = function() {
                        if (xhr.status === 200) {
                            var reader = new FileReader();
                            reader.onloadend = function() {
                                userProfile.photoBase64 = reader.result;
                                log('Photo loaded');
                                updateDebug();
                            };
                            reader.readAsDataURL(xhr.response);
                        } else {
                            log('Photo not available: ' + xhr.status);
                        }
                    };
                    
                    xhr.onerror = function() {
                        log('Photo fetch error');
                    };
                    
                    xhr.send();
                });
            } catch (e) {
                log('Photo error: ' + e.message);
            }
        }

        function detectAPI() {
            try {
                var versions = ['1.10', '1.9', '1.8', '1.5', '1.3', '1.1'];
                for (var i = 0; i < versions.length; i++) {
                    if (Office.context.requirements && Office.context.requirements.isSetSupported('Mailbox', versions[i])) {
                        apiInfo.version = versions[i];
                        break;
                    }
                }
                
                if (Office.context.mailbox && Office.context.mailbox.item && Office.context.mailbox.item.body) {
                    apiInfo.hasSetSelectedData = typeof Office.context.mailbox.item.body.setSelectedDataAsync === 'function';
                    apiInfo.hasBodySet = typeof Office.context.mailbox.item.body.setAsync === 'function';
                    apiInfo.hasBodyGet = typeof Office.context.mailbox.item.body.getAsync === 'function';
                    apiInfo.hasSetSignature = typeof Office.context.mailbox.item.body.setSignatureAsync === 'function';
                }
                log('API v' + apiInfo.version);
            } catch (e) {
                log('API detect error: ' + e.message);
            }
            updateDebug();
        }

        function loadProfile() {
            try {
                if (Office.context.mailbox && Office.context.mailbox.userProfile) {
                    userProfile.displayName = Office.context.mailbox.userProfile.displayName || 'SIMO Employee';
                    userProfile.email = Office.context.mailbox.userProfile.emailAddress || '';
                    log('Profile: ' + userProfile.displayName);
                }
                updateUserCard();
            } catch (e) {
                log('Profile error: ' + e.message);
            }
        }

        function updateUserCard() {
            document.getElementById('userName').textContent = userProfile.displayName;
            document.getElementById('userEmail').textContent = userProfile.email;
            document.getElementById('userTitle').textContent = userProfile.jobTitle || 'SIMO GmbH';
        }

        function loadSettings() {
            try {
                var saved = localStorage.getItem('simoSigSettings');
                if (saved) {
                    var parsed = JSON.parse(saved);
                    for (var key in parsed) {
                        if (userSettings.hasOwnProperty(key)) {
                            userSettings[key] = parsed[key];
                        }
                    }
                }
                document.getElementById('showProfilePhoto').checked = userSettings.showProfilePhoto;
                document.getElementById('showPhone').checked = userSettings.showPhone;
                document.getElementById('showMobile').checked = userSettings.showMobile;
                document.getElementById('showSocialMedia').checked = userSettings.showSocialMedia;
                document.getElementById('showTeams').checked = userSettings.showTeams;
                document.getElementById('customPhone').value = userSettings.customPhone || '';
                document.getElementById('customMobile').value = userSettings.customMobile || '';
                document.getElementById('fontFamily').value = userSettings.font;
                document.getElementById('nameColor').value = userSettings.nameColor;
            } catch (e) {
                log('Settings error: ' + e.message);
            }
        }

        function saveSettings() {
            userSettings.showProfilePhoto = document.getElementById('showProfilePhoto').checked;
            userSettings.showPhone = document.getElementById('showPhone').checked;
            userSettings.showMobile = document.getElementById('showMobile').checked;
            userSettings.showSocialMedia = document.getElementById('showSocialMedia').checked;
            userSettings.showTeams = document.getElementById('showTeams').checked;
            userSettings.customPhone = document.getElementById('customPhone').value;
            userSettings.customMobile = document.getElementById('customMobile').value;
            userSettings.font = document.getElementById('fontFamily').value;
            userSettings.nameColor = document.getElementById('nameColor').value;
            
            try {
                localStorage.setItem('simoSigSettings', JSON.stringify(userSettings));
            } catch (e) {}
        }

        function getSignatureHTML() {
            var phone = userSettings.customPhone || userProfile.phone || COMPANY.phone;
            var mobile = userSettings.customMobile || userProfile.mobile;
            var title = userProfile.jobTitle || '';

            var phoneHTML = '';
            if (userSettings.showPhone && phone) {
                phoneHTML += 'phone. <a href="tel:' + phone.replace(/\s/g, '') + '" style="color:' + userSettings.contactColor + ';text-decoration:none;">' + phone + '</a><br>';
            }
            if (userSettings.showMobile && mobile) {
                phoneHTML += 'mobile. <a href="tel:' + mobile.replace(/\s/g, '') + '" style="color:' + userSettings.contactColor + ';text-decoration:none;">' + mobile + '</a><br>';
            }

            // Profile photo HTML
            var photoHTML = '';
            if (userSettings.showProfilePhoto && userProfile.photoBase64) {
                photoHTML = '<td style="padding-right:15px;vertical-align:top;">' +
                    '<img src="' + userProfile.photoBase64 + '" width="80" height="80" alt="Photo" style="border-radius:50%;display:block;" border="0">' +
                '</td>';
            }

            var socialHTML = '';
            if (userSettings.showSocialMedia) {
                socialHTML = '<tr><td ' + (photoHTML ? 'colspan="2" ' : '') + 'style="padding-top:15px;">' +
                    '<a href="' + COMPANY.social.linkedin + '" style="text-decoration:none;margin-right:6px;">' +
                        '<img src="' + ICONS.linkedin + '" width="24" height="24" alt="LinkedIn" style="display:inline-block;vertical-align:middle;" border="0">' +
                    '</a>' +
                    '<a href="' + COMPANY.social.youtube + '" style="text-decoration:none;margin-right:6px;">' +
                        '<img src="' + ICONS.youtube + '" width="24" height="24" alt="YouTube" style="display:inline-block;vertical-align:middle;" border="0">' +
                    '</a>' +
                    '<a href="' + COMPANY.social.instagram + '" style="text-decoration:none;margin-right:6px;">' +
                        '<img src="' + ICONS.instagram + '" width="24" height="24" alt="Instagram" style="display:inline-block;vertical-align:middle;" border="0">' +
                    '</a>' +
                    '<a href="' + COMPANY.social.x + '" style="text-decoration:none;margin-right:6px;">' +
                        '<img src="' + ICONS.x + '" width="24" height="24" alt="X" style="display:inline-block;vertical-align:middle;" border="0">' +
                    '</a>' +
                    '<a href="' + COMPANY.social.tiktok + '" style="text-decoration:none;margin-right:6px;">' +
                        '<img src="' + ICONS.tiktok + '" width="24" height="24" alt="TikTok" style="display:inline-block;vertical-align:middle;" border="0">' +
                    '</a>';
                
                if (userSettings.showTeams && userProfile.email) {
                    socialHTML += '<a href="https://teams.microsoft.com/l/chat/0/0?users=' + userProfile.email + '" style="text-decoration:none;">' +
                        '<img src="' + ICONS.teams + '" width="24" height="24" alt="Teams" style="display:inline-block;vertical-align:middle;" border="0">' +
                    '</a>';
                }
                socialHTML += '</td></tr>';
            }

            return '<table cellspacing="0" cellpadding="0" border="0" style="font-family:' + userSettings.font + ';font-size:10pt;">' +
                '<tr>' +
                    photoHTML +
                    '<td style="padding-bottom:10px;vertical-align:top;">' +
                        '<span style="font-size:12pt;font-weight:bold;color:' + userSettings.nameColor + ';">' + userProfile.displayName + '</span><br>' +
                        (title ? '<span style="color:' + userSettings.contactColor + ';">' + title + '</span><br>' : '') +
                        '<br>' +
                        '<span style="color:' + userSettings.contactColor + ';">' +
                            phoneHTML +
                            'email. <a href="mailto:' + userProfile.email + '" style="color:' + userSettings.contactColor + ';text-decoration:none;">' + userProfile.email + '</a>' +
                        '</span>' +
                    '</td>' +
                '</tr>' +
                '<tr><td ' + (photoHTML ? 'colspan="2" ' : '') + 'style="padding-top:10px;">' +
                    '<a href="' + COMPANY.website + '">' +
                        '<img src="' + COMPANY.logo + '" width="150" height="49" alt="SIMO" style="display:block;" border="0">' +
                    '</a>' +
                '</td></tr>' +
                '<tr><td ' + (photoHTML ? 'colspan="2" ' : '') + 'style="padding-top:5px;">' +
                    '<span style="font-size:9pt;color:' + userSettings.contactColor + ';">' + COMPANY.address + ' | ' + COMPANY.city + '</span>' +
                '</td></tr>' +
                socialHTML +
            '</table><br>';
        }

        function getLegalHTML() {
            return '<hr style="border:none;border-top:1px solid #c5c8cb;margin-top:20px;">' +
                '<p style="color:#c5c8cb;font-size:8pt;font-family:' + userSettings.font + ';line-height:1.4;">' +
                'Diese E-Mail enth√§lt vertrauliche und/oder rechtlich gesch√ºtzte Informationen. Wenn Sie nicht der beabsichtigte Empf√§nger sind, informieren Sie bitte sofort den Absender und l√∂schen Sie diese E-Mail. Das unbefugte Kopieren dieser E-Mail oder die unbefugte Weitergabe der enthaltenen Informationen ist nicht gestattet.<br><br>' +
                'The information contained in this message is confidential or protected by law. If you are not the intended recipient, please contact the sender and delete this message. Any unauthorised copying of this message or unauthorised distribution of the information contained herein is prohibited.' +
                '</p>' +
                '<hr style="border:none;border-top:1px solid #c5c8cb;">' +
                '<p style="color:#c5c8cb;font-size:8pt;font-family:' + userSettings.font + ';line-height:1.4;">' +
                '<strong>Gesetzliche Pflichtangaben / Legal Information:</strong><br>' +
                COMPANY.name + ' | Sitz: Aschaffenburg | ' + COMPANY.legal.court + '<br>' +
                'USt-IdNr./VAT-ID: ' + COMPANY.legal.vatId + ' | ' + COMPANY.address + ', ' + COMPANY.city + '<br>' +
                'Gesch√§ftsf√ºhrung: ' + COMPANY.legal.mgmt +
                '</p>';
        }

        function applySignature(type) {
            showStatus('<div class="spinner"></div><span>Applying...</span>', 'loading');
            log('Apply: ' + type);

            var html;
            var append = false;

            if (type === 'default') {
                html = getSignatureHTML();
            } else if (type === 'full') {
                html = getSignatureHTML() + getLegalHTML();
            } else if (type === 'legalonly') {
                html = getLegalHTML();
                append = true;
            }

            if (append) {
                tryAppend(html);
            } else {
                tryInsert(html);
            }
        }

        function tryInsert(html) {
            if (apiInfo.hasSetSelectedData) {
                Office.context.mailbox.item.body.setSelectedDataAsync(
                    html,
                    { coercionType: Office.CoercionType.Html },
                    function(result) {
                        if (result.status === Office.AsyncResultStatus.Succeeded) {
                            log('Success: setSelectedData');
                            showStatus('‚úì Signature applied!', 'ready');
                        } else {
                            log('Failed setSelectedData: ' + (result.error ? result.error.message : 'unknown'));
                            tryInsertFallback(html);
                        }
                    }
                );
            } else {
                tryInsertFallback(html);
            }
        }

        function tryInsertFallback(html) {
            if (apiInfo.hasSetSignature) {
                Office.context.mailbox.item.body.setSignatureAsync(
                    html,
                    { coercionType: Office.CoercionType.Html },
                    function(result) {
                        if (result.status === Office.AsyncResultStatus.Succeeded) {
                            log('Success: setSignature');
                            showStatus('‚úì Signature applied!', 'ready');
                        } else {
                            log('Failed setSignature');
                            tryPrepend(html);
                        }
                    }
                );
            } else {
                tryPrepend(html);
            }
        }

        function tryPrepend(html) {
            if (apiInfo.hasBodyGet && apiInfo.hasBodySet) {
                Office.context.mailbox.item.body.getAsync(
                    Office.CoercionType.Html,
                    function(getResult) {
                        if (getResult.status === Office.AsyncResultStatus.Succeeded) {
                            var newBody = html + (getResult.value || '');
                            Office.context.mailbox.item.body.setAsync(
                                newBody,
                                { coercionType: Office.CoercionType.Html },
                                function(setResult) {
                                    if (setResult.status === Office.AsyncResultStatus.Succeeded) {
                                        log('Success: prepend');
                                        showStatus('‚úì Signature applied!', 'ready');
                                    } else {
                                        log('Failed prepend');
                                        showStatus('Error applying signature.', 'error');
                                    }
                                }
                            );
                        } else {
                            showStatus('Error: could not get body.', 'error');
                        }
                    }
                );
            } else {
                showStatus('Error: No compatible API.', 'error');
            }
        }

        function tryAppend(html) {
            if (apiInfo.hasBodyGet && apiInfo.hasBodySet) {
                Office.context.mailbox.item.body.getAsync(
                    Office.CoercionType.Html,
                    function(getResult) {
                        if (getResult.status === Office.AsyncResultStatus.Succeeded) {
                            var newBody = (getResult.value || '') + html;
                            Office.context.mailbox.item.body.setAsync(
                                newBody,
                                { coercionType: Office.CoercionType.Html },
                                function(setResult) {
                                    if (setResult.status === Office.AsyncResultStatus.Succeeded) {
                                        log('Success: append');
                                        showStatus('‚úì Legal footer added!', 'ready');
                                    } else {
                                        showStatus('Error appending.', 'error');
                                    }
                                }
                            );
                        } else {
                            showStatus('Error: could not get body.', 'error');
                        }
                    }
                );
            } else {
                showStatus('Error: No compatible API.', 'error');
            }
        }

        function showStatus(msg, type) {
            var el = document.getElementById('status');
            el.className = 'status-bar ' + type;
            el.innerHTML = msg;
        }

        function switchView(view) {
            document.querySelectorAll('.view').forEach(function(v) { v.classList.remove('active'); });
            document.querySelectorAll('.nav-btn').forEach(function(b) { b.classList.remove('active'); });
            
            if (view === 'signatures') {
                document.getElementById('signaturesView').classList.add('active');
                document.getElementById('navSignatures').classList.add('active');
            } else {
                document.getElementById('settingsView').classList.add('active');
                document.getElementById('navSettings').classList.add('active');
                updateDebug();
            }
        }
    </script>
</body>
</html>
