<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMO Email Signatures</title>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: #3d5875;
            color: white;
            padding: 16px 24px;
            border-bottom: 3px solid #2a3f54;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .header p {
            font-size: 13px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .container {
            padding: 20px;
        }

        /* Views */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Signature Section */
        .section {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .section-header {
            background: #f6f8fa;
            border-bottom: 1px solid #e1e4e8;
            padding: 12px 20px;
            font-weight: 600;
            font-size: 15px;
        }

        #signatureList {
            display: flex;
            flex-direction: column;
        }

        .signature-btn {
            background: white;
            border: none;
            border-bottom: 1px solid #e1e4e8;
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .signature-btn:last-child {
            border-bottom: none;
        }

        .signature-btn:hover {
            background: #f6f8fa;
        }

        .signature-btn:active {
            background: #e8f4f8;
        }

        .signature-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .signature-info {
            flex: 1;
        }

        .signature-info h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #333;
        }

        .signature-info p {
            font-size: 12px;
            color: #666;
        }

        .btn-primary {
            background: #3d5875;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }

        .btn-primary:hover {
            background: #2a3f54;
        }

        .btn-secondary {
            background: white;
            color: #3d5875;
            border: 2px solid #3d5875;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s;
            margin-top: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background: #f6f8fa;
        }

        /* Custom Builder Styles */
        .builder-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .builder-section {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 16px;
        }

        .builder-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #3d5875;
        }

        .templates-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .template-card {
            border: 2px solid #e1e4e8;
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .template-card:hover {
            border-color: #3d5875;
            background: #f6f8fa;
        }

        .template-card.selected {
            border-color: #3d5875;
            background: #e8f4f8;
        }

        .template-card h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .template-card p {
            font-size: 11px;
            color: #666;
        }

        .components-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .component-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .component-item:hover {
            background: #f6f8fa;
        }

        .component-item.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .component-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .component-label {
            flex: 1;
            font-size: 13px;
            margin-left: 10px;
        }

        .preview-box {
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 16px;
            background: #fafbfc;
            max-height: 300px;
            overflow-y: auto;
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
        }

        .input-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .button-group button {
            flex: 1;
        }

        .back-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .back-button:hover {
            background: #5a6268;
        }

        .status-message {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 13px;
            text-align: center;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üñäÔ∏è SIMO Email Signatures</h1>
        <p>Professional signatures for your organization</p>
    </div>

    <div class="container">
        <!-- Main Signature List View -->
        <div id="mainView" class="view active">
            <div class="section">
                <div class="section-header">Pre-configured Signatures</div>
                <div id="signatureList">
                    <!-- Buttons will be added here by JavaScript -->
                </div>
            </div>

            <button class="btn-secondary" onclick="showCustomBuilder()">
                <span>‚ú®</span>
                <span>Create Custom Signature</span>
            </button>
        </div>

        <!-- Custom Signature Builder View -->
        <div id="builderView" class="view">
            <div id="builderStatus"></div>

            <div class="builder-container">
                <div class="builder-section">
                    <h3>1. Choose a Template</h3>
                    <div class="templates-grid" id="templatesList"></div>
                </div>

                <div class="builder-section">
                    <h3>2. Select Components</h3>
                    <div class="components-list" id="componentsList"></div>
                </div>

                <div class="builder-section">
                    <h3>3. Customize Text (Optional)</h3>
                    <div class="input-group">
                        <label>Custom Title/Tagline</label>
                        <input type="text" id="customTitle" placeholder="e.g., Innovation Starts Here">
                    </div>
                    <div class="input-group">
                        <label>Additional Text</label>
                        <textarea id="customText" placeholder="e.g., Schedule a meeting with me"></textarea>
                    </div>
                </div>

                <div class="builder-section">
                    <h3>4. Preview</h3>
                    <div class="preview-box" id="signaturePreview">
                        <p style="color: #666; text-align: center; padding: 20px;">Select a template to see preview</p>
                    </div>
                </div>

                <div class="button-group">
                    <button class="back-button" onclick="showMainView()">‚Üê Back</button>
                    <button class="btn-primary" onclick="applyCustomSignature()">Apply Signature</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let userProfile = {};
        let selectedTemplate = null;
        let selectedComponents = {
            logo: true,
            name: true,
            jobTitle: true,
            email: true,
            mobilePhone: false,
            businessPhone: false,
            linkedin: false,
            teams: false
        };

        const templates = [
            { id: 'minimal', name: 'Minimal', description: 'Clean & simple', style: 'minimal' },
            { id: 'professional', name: 'Professional', description: 'Classic corporate', style: 'professional' },
            { id: 'modern', name: 'Modern', description: 'Bold & contemporary', style: 'modern' },
            { id: 'social', name: 'Social Focus', description: 'Social media emphasis', style: 'social' }
        ];

        const components = [
            { id: 'logo', label: 'Company Logo', required: false },
            { id: 'name', label: 'Full Name', required: true },
            { id: 'jobTitle', label: 'Job Title', required: true },
            { id: 'email', label: 'Email Address', required: true },
            { id: 'mobilePhone', label: 'Mobile Phone', required: false },
            { id: 'businessPhone', label: 'Business Phone', required: false },
            { id: 'linkedin', label: 'LinkedIn Icon', required: false },
            { id: 'teams', label: 'Microsoft Teams Icon', required: false }
        ];

        // Initialize when Office is ready
        Office.onReady(function() {
            getUserProfile();
            loadSignatures();
            renderTemplates();
            renderComponents();
        });

        function getUserProfile() {
            Office.context.mailbox.getUserIdentityTokenAsync(function(result) {
                if (result.status === Office.AsyncResultStatus.Succeeded) {
                    // Parse the token to get user info
                    try {
                        const token = result.value;
                        const base64Url = token.split('.')[1];
                        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                        }).join(''));
                        const payload = JSON.parse(jsonPayload);
                        
                        userProfile = {
                            displayName: Office.context.mailbox.userProfile.displayName || '[Your Name]',
                            email: Office.context.mailbox.userProfile.emailAddress || '[email@example.com]',
                            givenName: '[First Name]',
                            surname: '[Last Name]',
                            jobTitle: '[Job Title]',
                            mobilePhone: '',
                            businessPhones: []
                        };
                    } catch (e) {
                        console.error('Error parsing token:', e);
                    }
                }
            });
        }

        function loadSignatures() {
            // Create signature buttons directly
            const signatureList = document.getElementById('signatureList');
            
            const signatures = [
                {
                    name: 'Default Signature',
                    description: 'Standard SIMO employee signature',
                    icon: 'üìß',
                    html: getDefaultSignatureHTML()
                },
                {
                    name: 'All Mail Signature',
                    description: 'Signature with legal disclaimer',
                    icon: 'üìÑ',
                    html: getAllMailSignatureHTML()
                }
            ];

            signatureList.innerHTML = signatures.map((sig, index) => `
                <button class="signature-btn" onclick="applySignature(${index})">
                    <div class="signature-icon">${sig.icon}</div>
                    <div class="signature-info">
                        <h3>${sig.name}</h3>
                        <p>${sig.description}</p>
                    </div>
                </button>
            `).join('');
        }

        function getDefaultSignatureHTML() {
            return `<table style="WIDTH: 508px; FONT-SIZE: 10pt; FONT-FAMILY: Arial; MARGIN-TOP: 0px; MARGIN-BOTTOM: 5pt" cellspacing="0" cellpadding="0" border="0"><tbody><tr><td style="FONT-SIZE: 10pt; FONT-FAMILY: Arial; PADDING-BOTTOM: 10px" valign="top"><span style="FONT-SIZE: 14pt"><strong><font color="#152979">${userProfile.displayName || Office.context.mailbox.userProfile.displayName}</font></strong></span><br><span style="font-size: 10pt; color: #9a9a9a;">${userProfile.jobTitle || '[Job Title]'}</span><br><br><span style="font-size: 9pt; color: #9a9a9a;">email. <a href="mailto:${userProfile.email || Office.context.mailbox.userProfile.emailAddress}" style="color: #9a9a9a; text-decoration: none;">${userProfile.email || Office.context.mailbox.userProfile.emailAddress}</a></span></td></tr></tbody></table><table cellspacing="0" cellpadding="0" border="0" style="font-size: 10pt; WIDTH: 508px"><tbody><tr><td valign="top" style="padding-bottom: 10px; padding-top: 10px;"><a href="https://www.simo-online.com/"><img src="https://nikolai-SIMO.github.io/simo-signature-addon/simo-logo.png" border="0" width="150" height="49" alt="SIMO logo" style="display: block;"></a></td></tr><tr><td valign="top" style="padding-bottom: 10px; padding-top: 10px;"><a href="https://www.linkedin.com/company/simo-online" style="text-decoration: none;"><img src="https://nikolai-SIMO.github.io/simo-signature-addon/linkedin-icon.png" border="0" width="32" height="32" alt="LinkedIn" style="display: inline-block; margin-right: 8px;"></a><a href="https://teams.microsoft.com/l/chat/0/0?users=${userProfile.email || Office.context.mailbox.userProfile.emailAddress}" style="text-decoration: none;"><img src="https://nikolai-SIMO.github.io/simo-signature-addon/teams-icon.png" border="0" width="32" height="32" alt="Microsoft Teams" style="display: inline-block;"></a></td></tr></tbody></table>`;
        }

        function getAllMailSignatureHTML() {
            const defaultSig = getDefaultSignatureHTML();
            return defaultSig + `<hr style="color: rgb(197, 200, 203); margin-top: 20px;"><p style="color: rgb(197, 200, 203); font-size: 8pt; font-family: Arial; margin-top: 5pt;">Diese E-Mail enthaelt vertrauliche und/oder rechtlich geschuetzte Informationen. Wenn Sie nicht der beabsichtigte Empfaenger sind, informieren Sie bitte sofort den Absender und loeschen Sie diese E-Mail. Das unbefugte Kopieren dieser E-Mail oder die unbefugte Weitergabe der enthaltenen Informationen ist nicht gestattet. /|/ The information contained in this message is confidential or protected by law. If you are not the intended recipient, please contact the sender and delete this message. Any unauthorised copying of this message or unauthorised distribution of the information contained herein is prohibited.</p><hr style="color: rgb(197, 200, 203);"><p style="color: rgb(197, 200, 203); font-size: 8pt; font-family: Arial; margin-top: 5pt;">Legally required information for business correspondence/ Gesetzliche Pflichtangaben fuer Geschaeftskorrespondenz<br>Unternehmen/Company: SIMO GmbH mit Sitz/with registered seat in Aschaffenburg, Amtsgericht/local court Aschaffenburg HRB 15769, Umsatzsteuer-Identifikationsnummer / VAT-ID DE335322803, Geschaeftsanschrift: W√ºrzburger Stra√üe 152, 63743 Aschaffenburg<br>Geschaeftsfuehrung/Management Board: Thomas Wassum und Andreas O. Schwan</p>`;
        }

        function applySignature(index) {
            const signatures = [
                { html: getDefaultSignatureHTML() },
                { html: getAllMailSignatureHTML() }
            ];

            const signatureHTML = signatures[index].html;

            Office.context.mailbox.item.body.setSignatureAsync(
                signatureHTML,
                { coercionType: Office.CoercionType.Html },
                function(asyncResult) {
                    if (asyncResult.status === Office.AsyncResultStatus.Failed) {
                        alert('Error applying signature: ' + asyncResult.error.message);
                    } else {
                        alert('Signature applied successfully!');
                    }
                }
            );
        }

        function showCustomBuilder() {
            document.getElementById('mainView').classList.remove('active');
            document.getElementById('builderView').classList.add('active');
        }

        function showMainView() {
            document.getElementById('builderView').classList.remove('active');
            document.getElementById('mainView').classList.add('active');
        }

        function renderTemplates() {
            const list = document.getElementById('templatesList');
            list.innerHTML = templates.map(template => `
                <div class="template-card ${selectedTemplate?.id === template.id ? 'selected' : ''}" 
                     onclick="selectTemplate('${template.id}')">
                    <h4>${template.name}</h4>
                    <p>${template.description}</p>
                </div>
            `).join('');
        }

        function renderComponents() {
            const list = document.getElementById('componentsList');
            list.innerHTML = components.map(comp => `
                <div class="component-item ${comp.required ? 'disabled' : ''}">
                    <input type="checkbox" 
                           id="comp_${comp.id}" 
                           ${selectedComponents[comp.id] ? 'checked' : ''}
                           ${comp.required ? 'disabled checked' : ''}
                           onchange="toggleComponent('${comp.id}')">
                    <label class="component-label" for="comp_${comp.id}">
                        ${comp.label}${comp.required ? ' (Required)' : ''}
                    </label>
                </div>
            `).join('');
        }

        function selectTemplate(templateId) {
            selectedTemplate = templates.find(t => t.id === templateId);
            renderTemplates();
            updatePreview();
        }

        function toggleComponent(componentId) {
            selectedComponents[componentId] = !selectedComponents[componentId];
            updatePreview();
        }

        function updatePreview() {
            if (!selectedTemplate) return;

            const preview = document.getElementById('signaturePreview');
            const customTitle = document.getElementById('customTitle')?.value || '';
            const customText = document.getElementById('customText')?.value || '';

            const signatureHTML = generateSignatureHTML(selectedTemplate, selectedComponents, customTitle, customText);
            preview.innerHTML = signatureHTML;
        }

        function generateSignatureHTML(template, components, customTitle, customText) {
            let html = '<table cellpadding="0" cellspacing="0" style="font-family: Arial, sans-serif; font-size: 12px; line-height: 1.5;">';
            
            if (components.logo) {
                html += '<tr><td style="padding-bottom: 10px;"><img src="https://nikolai-SIMO.github.io/simo-signature-addon/simo-logo.png" alt="SIMO Logo" style="height: 40px; display: block;"></td></tr>';
            }

            if (customTitle) {
                html += `<tr><td style="font-weight: bold; color: #3d5875; padding-bottom: 8px; font-size: 13px;">${customTitle}</td></tr>`;
            }

            if (components.name) {
                html += `<tr><td style="font-weight: bold; font-size: 14px; color: #333; padding-bottom: 4px;">${userProfile.displayName || Office.context.mailbox.userProfile.displayName}</td></tr>`;
            }

            if (components.jobTitle) {
                html += `<tr><td style="color: #666; padding-bottom: 8px;">${userProfile.jobTitle || '[Job Title]'}</td></tr>`;
            }

            if (components.email) {
                html += `<tr><td style="padding-bottom: 4px;"><a href="mailto:${userProfile.email || Office.context.mailbox.userProfile.emailAddress}" style="color: #3d5875; text-decoration: none;">${userProfile.email || Office.context.mailbox.userProfile.emailAddress}</a></td></tr>`;
            }

            if (components.mobilePhone && userProfile.mobilePhone) {
                html += `<tr><td style="padding-bottom: 4px;">üì± ${userProfile.mobilePhone}</td></tr>`;
            }

            if (components.businessPhone && userProfile.businessPhones?.[0]) {
                html += `<tr><td style="padding-bottom: 4px;">‚òéÔ∏è ${userProfile.businessPhones[0]}</td></tr>`;
            }

            if (customText) {
                html += `<tr><td style="padding-top: 8px; padding-bottom: 4px; font-style: italic; color: #666; font-size: 11px;">${customText}</td></tr>`;
            }

            if (components.linkedin || components.teams) {
                html += '<tr><td style="padding-top: 10px;">';
                if (components.linkedin) {
                    html += '<a href="https://linkedin.com/company/simo-gmbh" style="margin-right: 10px; text-decoration: none; color: #0077b5;">üîó LinkedIn</a>';
                }
                if (components.teams) {
                    html += '<span style="color: #6264A7;">üí¨ Teams</span>';
                }
                html += '</td></tr>';
            }

            html += '</table>';
            return html;
        }

        function applyCustomSignature() {
            if (!selectedTemplate) {
                showStatus('Please select a template first', 'error');
                return;
            }

            const customTitle = document.getElementById('customTitle').value;
            const customText = document.getElementById('customText').value;
            const signatureHTML = generateSignatureHTML(selectedTemplate, selectedComponents, customTitle, customText);

            Office.context.mailbox.item.body.setSignatureAsync(
                signatureHTML,
                { coercionType: Office.CoercionType.Html },
                function(result) {
                    if (result.status === Office.AsyncResultStatus.Succeeded) {
                        showStatus('‚úì Custom signature applied successfully!', 'success');
                        setTimeout(showMainView, 2000);
                    } else {
                        showStatus('‚ùå Failed to apply signature', 'error');
                    }
                }
            );
        }

        function showStatus(message, type) {
            const status = document.getElementById('builderStatus');
            status.innerHTML = `<div class="status-message ${type}">${message}</div>`;
            setTimeout(() => status.innerHTML = '', 5000);
        }

        // Event listeners for custom field updates
        setTimeout(() => {
            const customTitle = document.getElementById('customTitle');
            const customText = document.getElementById('customText');
            
            if (customTitle) customTitle.addEventListener('input', updatePreview);
            if (customText) customText.addEventListener('input', updatePreview);
        }, 100);
    </script>
</body>
</html>
